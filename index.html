<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="donoghuc DADA">
    <meta name="author" content="Cas Donoghue">
    <link rel="shortcut icon"
          href="img/site/Hallows.png">
    <title>donoghuc CS373</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/resume.min.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">
        <span class="d-block d-lg-none">D.A.D.A</span>
        <span class="d-none d-lg-block">
          <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/site/profile.jpg" alt="">
        </span>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_1">Week 1</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_2">Week 2</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_3">Week 3</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_4">Week 4</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_5">Week 5</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_6">Week 6</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_7">Week 7</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_8">Week 8</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_9">Week 9</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_10">Week 10</a>
          </li>

        </ul>
      </div>
    </nav>

    <!-- ABOUT -->

    <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5 d-flex d-column" id="about">
        <div class="my-auto">
          <h1 class="mb-0">Cas
            <span class="text-primary">Donoghue</span>
          </h1>

          <div class="subheading mb-5"> Defense Against The Dark Arts · CS373 · donoghuc 
          </div>
          <p class="mb-2">This site has my notes for each week of D.A.D.A. Use the navigation bar to select week of interest. </p>
          <p class="mb-2">I am using the engr web server to host this site. The source code can be found on <a href="https://github.com/donoghuc/public_html" target="_blank"> github</a>. Please see repo for image credits</p>
          <p class="mb-5"><b>NOTE:</b> For the non-potterheads out there Defense Against The Dark Arts is a class at Hogwarts in the Harry Potter novels. The profile picture in the nav bar is Gilderoy Lockahrt, although he is a charlatan he is a lovable and hillarius character. Also die-hard fans may recognize the favicon for the site as the symbol of the deathly hallows.</p>
        </div>
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_1">
        <div class="my-auto">
          <h2 class="mb-5">Week 1</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">

             <h4> What is Malware? </h4>
             <p> Malware is a concatenation of the words “malicious” and “software”. It is a term used to describe software used to perform nefarious and unwanted actions on a system.
             </p>

             <h4>Whyyyyy????? </h4>
             <p>Humans (and any living creature) are self-interested and often times the path of least resistance to survival is to take what you want by force. If something is exploitable (software or otherwise) it will inevitably be taken advantage of by someone. The attack surface for software systems offers a vast opportunity for exploit by hackers who want to profit from spying, stealing or destroying systems. Society’s fast adoption of and utter reliance on software systems are a massive vulnerability. Exploiting that vulnerability can be profitable by cyber criminals who can safely carry out their crimes in the comfort of their office chair. 
             </p>

             <h4>Malware types</h4>
             <p>
               <ul>
                 <li>
                   <b>Virus:</b> Typically an executable file that will start infection with some user interaction (ie running a program in an email attachment). 
                 </li>
                 <li>
                   <b>Worm:</b> Type of virus that can spread without user interaction (ie replication without user intervention). 
                 </li>
                 <li>
                   <b>Trojan:</b> A Trojan is malware hidden within a file type (PDF, word doc, excel, etc) which seems to be benign or useful to the user. Trojans are often associated with “backdoors” ie software that gives an attacker a way to silently monitor and control you computer. 
                 </li>
               </ul>
               <iframe width="420" height="315"
                  src="https://www.youtube.com/embed/y8a3QoTg4VQ">
               </iframe>
             </p>

             <h4>How does malware spread?</h4>
             <p>Attackers are innovative and engineer attack vectors in many clever ways. The general idea/theme is that a user is tricked in to installing the malicious code. This can be achieved through hiding malware in content the user might find interesting or useful. Instead of me presenting a list of different attack vectors I will share a personal example. I had a colleague when I worked in biotech who was hopelessly computer illiterate and extremely impatient. He wanted to convert an image file from .jpg to .tif and did a google search for a tool to do so. He downloaded and installed a “tool” and immediately regretted it! In this example the user was tricked into installing malicious code because he wanted a quick fix to a problem he did not want to research. It should also be noted that exploiting users just turns out to often be the “easiest” way to spread malware. There can also exist vulnerabilities in system code or hardware that allows attackers to install malware. These exploits often require more research and skill for the hacker to successfully utilize. 
             </p>

             <h4>Scary stuff</h4>
             <p>Malware can be used to spy on user activity and extract information (spyware). This is frightening enough but there are also Remote Access Trojans (RAT) that allow attackers to completely control an endpoint. The idea that a computer or server that you think you control is actually being controlled by a nefarious entity is a scary thought! 
             </p>

             <h4>Who can save us?</h4>
             <p>Luckily it is also profitable to be in the anti-malware business! Researchers and security firms are growing at an incredible rate and are trying to keep up against the threats. Security suffers from the classic problem that is it often more difficult to defend something than to attack it. In order for researchers in the industry to compare notes and describe malware they have come up with a naming convention. Unfortunately the naming convention is not always followed perfectly, instead the best way to archive and share information about malware is to calculate a hash value on malicious code. The hashes used are typically md5 and can be represented in a hexadecimal string that is unique and easily compared to other samples. Below I show some python code to take an md5 hash of a virus sample from lab1. 
             </p>
             <p><script src="https://gist.github.com/donoghuc/cfe4343f7c94d1c00f0c938a7b6eb166.js"></script></p>
             <h4>How do researchers study malware?</h4>
             <p>It is in the interest of an attacker to hide their actions and obfuscate their malicious code to dupe security analysts. This has resulted in an “arms race” between attackers and defenders that has escalated quickly. A researcher who looks only at code (which is often encrypted or intentionally vague or confusing) is perfroming <b>static analysis</b>. Static analysis can yield valuable insight into the malware and can actually give clues as to its origins. For example if everything is written in a certain language (think Russian, Chinese not java, c) or if it is using encryption techniques popular in particular “circles”. At the end of the day it can often be more beneficial to study malware by just observing it in action <b>(dynamic analysis)</b>. In order to do this dedicated systems are put in place (called sacrificial goats) to be studied. Of course attackers have gotten wise to this and created measures to try to detect goats and subvert research. Another closely related idea is to set up traps (honeypots) that attract malware to try to catch samples for study. Researchers have developed many tools to analyze exactly what malware is doing to infected systems. We explore some of these tools in lab this week. 
             </p>
             <h4>Lab 1</h4>
             <p>
             For our first lab we got access to a windows VM (heavily partitioned from network of course!). We preserve the “fresh” pre-infected state of the machine using snapshots, then infect the machine using a provided piece of malware. We used the following tools to perform analysis of the malware. 
             <ul>
               <li><b>FlyPaper:</b> Trap processes from closing and networking (can have some unintended consequences if you think about it!)</li> 
               <li><b>FakeNet:</b> Set up fake network protocol that captures the network requests of all processes running. Quite handy for determining how malware is trying to communicate back to attacker.</li>
               <li><b>ProcessExplorer:</b> Simple windows tool for logging every process that is being executed on a machine in excruciating detail. </li>
               <li><b>ProccessMonitor:</b> An interface to see high level execution steps of programs on a system.</li>
               <li><b>AntiSpy:</b> Deep dive into all files in a system (even hidden ones) with tons of amazing features for investigating files, registry keys etc.</li>
               <li><b>FileInsight:</b>Hex editor to look at binary code. Has tons of features for decryption and static file analysis. </li>
             </ul>
             We used these tools to examine a sample of malware designed to persist on a machine. We saw how it infects the machine, communicates back to attackers and then persists on the machine. After doing some research I found the following blog post that describes an example of the malware we investigated that was used to attack banks. The idea was to use the malware to silently redirect bank customer users to a fake site (that mimicked the real bank interface) to steal credentials. Furthermore the second stage of the attack allowed the attacker to have a backdoor into the system and update the system with new executable code persistently. <a href="https://blog.avast.com/2013/03/19/analysis-of-chinese-attack-against-korean-banks" target="_blank">Analysis of chinese attack against korean banks</a>  
             </p>
             <h4>Conclusion</h4>
             <p>This first week was highly inspiring. The lectures were by <a href="https://securingtomorrow.mcafee.com/author/christiaan-beek/" target="_blank">Christian Beek</a> who has a brilliant lecture style and is clearly an expert on security research. Christian’s lectures are engaging and informative in that he provides real world examples of malware and give insight into how researchers study infections. I cannot wait for next week’s lectures to be published! </p>
            </div>

          </div>
        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_2">
        <div class="my-auto">
          <h2 class="mb-5">Week 2</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 

             <h4>Forensics Overview</h4>
             <p>This week we dive in to advanced forensics techniques. The discussion is framed as an investigator looking in to a computer or system to understand what that system has been used for. As an investigator your job is to prove what happened on machine, not to prove whether an individual is guilty or not guilty. We focus on an objective analysis and methods to effectively handle volatile data collected from a machine. 
             </p>

             <h4>Data Collection</h4>
             <p>The first step in an investigation is to gather evidence. Evidence could include information about the network, operating system, databases, applications, removable media and other peripheral devices. Digital evidence is by nature somewhat fragile and susceptible to tampering. Standards and best practices have been developed to preserve data integrity such as hashing data on arrival and throughout the process making sure hashes match with the original. During an investigation it is important to consider <b>Locard’s Exchange Principle</b>: <em>for any two objects come in to contact, there is always transfer of material from each object to the other</em>. You cannot interact with a live system without having some effect on it. It is crucial to document and understand the effect you are having on the system to preserve evidence integrity.  
             </p>

             <h4>Data Fragility</h4>
             <p>Data is fragile in nature as it can be ephemeral in its existence in physical memory. A perfect example of highly volatile data is RAM. RAM is constantly in flux and specific physical memory is being overwritten over the course of the hardware’s lifetime. We will consider some data in context of its volatility from most volatile to least. The most volatile data is the system memory, this can easily be lost or damaged beyond repair. Temporary file systems are also quite volatile. Process tables and network connection information is ephemeral and can be lost over time. Similarly network routing information can be lost. More persistent data are data stored on disks, remote logging data, network topology information and finally system backups. Data should be collected as to minimize loss of volatile data.  
             </p>

             <h4>FTK Imager</h4>
             <p>FTK imager is a simple yet powerful tool for capturing an image of a hard disk. This allows a snapshot of the drive that can be shared and examined by researchers. As you would expect there are tools in the application that allow the researcher to generate and compare hashes of the image to determine data integrity. FTK imager was used to create the mayflower image for the investigation challenge below. (Note I am not going to make image of VM because it is boring…).  
             </p>

             <h4>Volatility</h4>
             <p>FTK imager is wonderful for investigating persistent disk storage. A tool for investigating RAM is important to discover the wealth of forensic data in physical memory. Analyzing RAM can reveal “hidden” artifacts that prove useful in investigation such as decrypted versions of otherwise encrypted data, keystrokes, WEP and WPA keys, username/passwords, DLL info (including malicious ones). At the end of the day every running process will leave some trace in memory. Volatility is a tool used to analyze a memory dump.  
             </p>

             <h4>Test out volatility</h4>
             <p> I copied volatility exe and memdump sample into a volatility_lab directory to investigate. I start with the imageinfo functionality. From here we can see the time the image was taken and other information. Specifically we are interested in the profile suggestions.  </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/volatility_img_info.png" class="img img-rounded img-fluid"/>
             </div>

             <p> After finding the profile information I can run psscan. This allows me to find process ID's for programs of interest (most notably evil.exe PID:1216)</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/psscan.png" class="img img-rounded img-fluid"/>
             </div>

             <p> Now I investigate the link libraries that evil.exe (PID: 1216) calls using dlllist</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/dlllist.png" class="img img-rounded img-fluid"/>
             </div>

             <p> Examine the network activity from mem dump with netscan. This shows evil.exe net activity. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/netscan.png" class="img img-rounded img-fluid"/>
             </div>

             <p> I tried running the deskscan plugin but did not find anything i could identify as malware. The getsids plugin is used for getting security IDs shows both evil.exe and svchest.exe. These show how "deep" into the system the malware has spread by showing the user rights and privileges the malware is running with.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/sids.png" class="img img-rounded img-fluid"/>
             </div>
             
             <h4>Timeline</h4>
             <p>It is important for the analyst to build up a timeline of actions that occurred on the machine being studied. Windows uses a file system called a registry to track and coordinate all activities that go occur on a machine. Regmon can be used to display registry activity in real time and you can see registers as a directory structure using regedit.exe. The Registry is a forensics log, you can find all sorts of information such as auto run tasks, geolocation, peripheral drives, internet activity etc. The registry can be helpful in building your timeline. The other tools that can help build a timeline are volatility, searching through the Master-File-Table and using a tool called Reg-Ripper.  
             </p>

             <h4>Data Recovery</h4>
             <p>When the casual user of a system deletes a file they tend to think that it is truly “gone from existence”. This is rarely the case. There are processes for recovering data that take advantage of how data is stored and managed on physical devices. In fact, data recovery tools are so advanced now that many institutions that need to truly erase sensitive data will destroy physical memory devices for fear of data being recovered! 
             </p>

             <h4>Mayflower Challenge</h4>
             <p>A DPRK Defector was caught close to the border of North and South Korea. The person was member of DPRK’s Unit 21 – Cyber-Army Division. The person had an USB-stick hidden in his clothes. An image was made of the USB-stick. 
             </p>
             <p>I first made sure I had a fresh snapshot of my clean VM. I then copied the Image_USB_Mayflower.001 image from the network share to a directory on my VM called mayflower. I mounted the image and aliased it to the E drive using OSFMOUNT and copied the directory to the mayflower directory on my desktop. I was curious about the names as they were in glyphs I do not understand. In order to investigate this I wanted to copy paste the files into google translate. The only problem is the VM does not allow any data transfer. To get around this I wrote some python code (both on the VM and my local machine) to do Optical Character Recognition so I could effectively copy paste the information. I have published that code as well as detailed setup in a <a href="https://github.com/donoghuc/python_ocr" target="_blank" > public git reposotory </a>.    
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/translation.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Next I wanted to see if there are any deleted files on the image. I order to do this I use photorec and dump the recovered files in the mayflower directory. I poke around and find quite a bit of information that was recovered. 
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/photo_req.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now based on a hint from the lecture I do a strings search on the “don’t tell mrs Il Ung.jpg” file and find the following match at offset 0x00003B0: ‘pwd:infected123!’. This is the password to the .zip file (target list.zip). I am able to extract the target list using the password.
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/pwd_infect123.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Here are the targets I found</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/targets.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Based on another lecture hint and an helpful post on the discussion boards by Joe Beauchesne I use file insight to search for “SPE” using the XOR text search plugin. The hint is in the file paths in the warning message image. This leads me to discover the usernames, passwords and some IP addresses hidden in the rootkit.bin file (see notepad for this info). </p>
 
             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/spe_hint.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now that I have investigated some things it is time to infect my machine! I fire up process monitor/explorer and fakenet. I rename the rootkit.bin file to rootkit.exe and run it. I do not see any activity on fakenet and I do not see any scheduled tasks with cmd.exe at command. I do however see an endless list of processes in process monotor. I stop collection and begin digging. The list of dlls and other modifications the software makes is staggering. Based on the name of the file it is a rootkit which could be making subtle changes and hiding easter eggs all over my system. I also try using flypaper and it eventually crashes my VM. I can only speculate at this point what the rootkit may be doing to the system. If I had not known based on the file name translation it would be difficult to even see the program is doing anything.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_2/run_rootkit.png" class="img img-rounded img-fluid"/>
             </div>          

             <h4>Conclusion</h4>
             <p>What an amazing, fun week! The tools we used such as volatility and imagerec are beyond cool. I cant wait to start doing image recovery on some old flash media I have laying around the house. I think that the mayflower project was really fun. I want to learn more about what the rootkit is doing. I find that my knowledge of windows OS is somewhat slowing me down. That is not to say I am any kind of linux master but I do feel way more at home with a bash shell. Looking forward to the weeks to come!  
             </p>
            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_3">
        <div class="my-auto">
          <h2 class="mb-5">Week 3</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 
             

             <h4>YARA</h4>

             <p> YARA is a tool used by security researchers to identify malicious files. The general Idea is that the analyst can define "rules" (think regular expressions) that identify strings common to malicious source code or artifacts. After defining the rules (expressions) to search for the tool searches file systems efficiently and reports files with matching signatures. Generating a yara signature and distributing it can be helpful to other researchers as well as consumers. Once a good signature is developed it can be unsed in the field to help identify malicious code. A good YARA signature is specific enough to minimize false positives (the case where a harmless file is identified) while maximizing the bredth of malware identified. Generation of a good YARA rule set can be a meticulous and time consuming process for a researcher.</p>

             <p>To get a sense for how YARA works I followed the lecture notes and wrote a signature to find Sytro malware.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/yara_sytro.png" class="img img-rounded img-fluid"/>
             </div>
            

             <h4>Cuckoo</h4>

             <p>A new tool introduced this week is called cuckoo. This is a tool used to help automate malware analysis. The tool is highly configurable and integrates with python allowing users to set up custom automations. The goal of the software is to provide a sandbox for the malware to run in with the underlying purpose of recording the execution and behavior of the malware. In our case we have a python script to set up and run malware that has been named “bad” and stored on the desktop. The result is a directory populated with log files describing the processes associated with running the malware. We will explore how cuckoo works in the blog post below. </p>


             <h4>Blog</h4>

             <p>In order to put in to practice the generation of yara signatures and automatic analysis using cuckoo we are given a challenge. On our virtual machines we have been provided 4 samples (see below). We are to analyze these samples and describe their behavior in a blog post. The blog post will be used to educate other users about the malware. As part of the blog post we will include a yara signature for the malware that we describe. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/challenge_files.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Initial Analysis</h4>

             <p>For each of the samples I make a copy to the desktop and name it “bad”. I start fakenet and run analyzer.py (cuckoo set up by our python config). In descending order (top to bottom in image above) the general behavior can be described as follows. The first sample does not register on fakenet and leaves two logs in the cuckoo log directory (bad, cmd.exe) there seems to be some suspicious registry key activity. The next sample down has the largest footprint. There are several log files generated for multiple processes. Windows pop up and file explorer crashes. One log is perpetually blocked because a process (found in task manager) with a name composed of Asian characters is running. The third sample down has a very small footprint and cuckoo runs very fast. Finally the last sample down runs and generates several logs. Note that for each file I revert to a fresh image of the virtual machine. </p>

             <p>In the lectures the instructor (Craig Schmugar) mentions that not all samples are necessarily malware. He also mentions that samples that have been packed are likely to be malware. I open each sample using file insight and find that the 4th sample (A1874F714F7A1539939FAE9681803303) is packed with UPX. The discovery of the packing in the 4th sample makes me want to investigate it further. </p>


             <h4>Deep Dive Into A187</h4>

             <p>I copy the A187 sample to the desktop and rename it to “bad”. I start fakenet and run analyzer.py. See screenshot below for relevant details. Notice that the file “bad” has been saved to the deskop, fakenet is being run and analyzer.py is executed. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/run_cuckoo.png" class="img img-rounded img-fluid"/>
             </div>

             <p>After execution I see three log files in C\cuckoo\logs. There is “bad” with PID 3316, prints.exe with PID 832 and cmd.exe with PID 1796. I notice in the “bad” log that there are files being appended to C:\Users\Admin\AppData\Local\Temp directory. I use Antispy to investigate. The snip below shows the files ntshruis2.dll, prints.exe, and qinput.png have been saved and set with hidden attributes. .  One highly suspicious activity is that the file disappears after being executed. This behavior makes me think it is part of the malware’s plan to remain hidden.  </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/A187_fingerprint.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>What Are These Temp Files?</h4>

             <p>I want to investigate the temporary files that have been added (as discovered using cuckoo logs). I start with the qinput.png file. I do not find anything particularly interesting in file insight using strings.all plugin. The image itself is encoded in some type of Asian characters. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/qinput.png" class="img img-rounded img-fluid"/>
             </div>
 
             <p>Next I investigate prints.exe using file insight. This appears to be a copy of the “bad” file that was deleted from the desktop when initially executed. I perform a stringsAll query and start to think about making a Yara signature. I see that this file is UPX packed as well. It is also important to note that it is executed when “bad” is executed. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/prints.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now I investigate the ntshruis2.dll file using file insight. This file has some beyond sketchy URLs to what appears to be an Asian bank. This information is revealed using stringsAll. I foolishly hit some of the sites on my VM (I am running a VM within a VM) and found some really shady Asian sites with tons of flash based popups. This file confirms my suspicion without a doubt that the A187 sample is malicious. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/dll.png" class="img img-rounded img-fluid"/>
             </div>

             <p>There are quite a few mentions of registry keys so I poked around a bit using anti spy. I was able to find a registry key that runs prints.exe! See the snip below for that information. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/first_reg.png" class="img img-rounded img-fluid"/>
             </div>

             <p>In the cuckoo logs I find a file that used to live in the temp folder where the other files investigated were. The name (as pictured below) is Deleteme.bat. I believe this file is responsible for deleting the “bad” file that kicked off the infection. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/deleteme.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>To The Internet!</h4>
             <p>Now that I have investigated some things it is time to google a bit. I search around for filenames and quickly find the following link <a href="https://home.mcafee.com/virusinfo/virusprofile.aspx?key=5030771#none" target="_blank" >https://home.mcafee.com/virusinfo/virusprofile.aspx?key=5030771#none</a>. This site describes a Trojan for remote access control. I do not see any network activity on the fakenet program but I believe that this malware is a Trojan. The links in the DLL file that call out Asian banks seem to be searching for some kind of information regarding banking. </p>

             <h4>Identification</h4>

             <p>I have written a Yara signature that can help find this malware on a machine. It targets both the original sample as well as the copy that is made (prints.exe). In order to build and test the Yara Signature I first copied prints.exe into the directory with the 4 original blog post samples. I looked through the stringsAll dump from prints.exe and the original sample to find strings that seemed specific and meaningful in the packed source code. I came up with what appears to be part of a link and an interesting string of characters that does not appear to be random. I run the Yara scan on the directory with the samples and get the following result which shows me that the signature identifies the sample and prints.exe and is at least specific enough for the 4 samples. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/yara_targeted.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now to test specificity I run a Yara scan on the Admin account. As you can see below the matches we find are in the Temp directory (as part of infection/replication), the samples in the Class2 folder and the definition of the Yara rules in the Yara tool directory. This shows that at least for this machine the rules are specific enough to only identify this bit of malware. </p>           

             <div class="col-sm-12 mb-3">
               <img src="./img/week_3/yara_specificity.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Conclusion</h4>

             <p>The investigation of the Trojan sample was informative for learning how malware can subvert the attention of the user. It was fun to track how the malware deletes itself from the original location and then “hides” in the Temp folder where it points a registry key. It is also interesting how it uses its own malicious DLL file to extend the code base in the executables. </p>

            </div>
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_4">
        <div class="my-auto">
          <h2 class="mb-5">Week 4</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 

             <h4>Exploitation</h4>

             <p>This week we are examining ways to deliver malware payloads to systems. So far we have focused on malware itself and not so much the delivery. Delivery can occur when a system is manipulated to allow an attacker to inject malware into a system. Understanding low level architecture x86 processors is important to effectively come up with exploits. The exploits we examine this week take advantage of how programs are interpreted and executed on the CPU to redirect the flow of execution to a hacker controlled instruction set. </p>

             <h4>Stack Attack</h4>

             <p>The call stack is fundamentally how programs execute. There are well defined rules for how the flow of execution through a program is carried out. By manipulating the call stack it is possible under some conditions to redirect the execution flow to attacker defined instructions. We examine the call stack with an example of browser attacks in IE8 using javascript. The tool we use this week for inspecting the calls tack and underlying assembly instructions is WinDbg. The following activities can be found at the following link: <a href="https://github.com/OpenSecurityResearch/FSExploitMe" target="_blank" >https://github.com/OpenSecurityResearch/FSExploitMe</a>. </p>

             <h4>WinDBG Hoops</h4>

             <p>I start up the FSExploitMe.html page in IE8 and allow the .ocx/pdb extensions. I then start up WinDGB and set a breakpoint. I show where the .ocx file is loaded in memory using “lmf m FSExploiteMe” command. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_1.png" class="img img-rounded img-fluid"/>
             </div>


             <p>The !teb command is used to examine the Thread Environment Block. In order to calculate the stack size we find the difference between StackBase and StackLimit (I think this is in Hex).  </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_2.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Information about the Process Execution block can be examined with the !peb command. The address of the Process heap can be obtained from the information captured in the output shown below. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_3.png" class="img img-rounded img-fluid"/>
             </div> 

             <p>Register values can be examined using the “r” command. For example the EIP register has the value of 54431df0.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_4.png" class="img img-rounded img-fluid"/>
             </div>

             <p>The disassemble (“u”) with the flag to show 10 lines (“L10) can be used to determine that there are 0x14 (20) bytes by examining the sub esp,14h line. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_5.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Five lines of the program are executed using “t” (t is for trace, also could have been done with "t 5") and then the memory (in Unicode) is shown at the pointer to esp register using the command “du poi(esp)”. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_6.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I run the loop after the breakpoint and find that it executes 10 times.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_7.png" class="img img-rounded img-fluid"/>
             </div>  

             <p>I execute the instructions until the end of the function and decode the return value (“.format eax”).</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_8.png" class="img img-rounded img-fluid"/>
             </div>

             <p>The final investigation for this exercise is to look at the value pointed to by the esi register. The value is the stack.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L1_9.png" class="img img-rounded img-fluid"/>
             </div>
              
            <h4>Stack Behavior</h4>

             <p>I set a breakpoint a 54421eb0, reset the windbg connection and trigger the breakpoint with the provided link. The address of the first instruction can be printed out with the “k” command. By looking at the disassembly at the value for eax and then tracing back we see that the first instruction is found at 54431e80.</p>

             <p>Based on the push values we see that the function is called with the arguement values 1, an offset for a string, and the hex value 26. </p>

             <p>The parameters signature of the function likely takes two integers and a string.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_1.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Crash Triage</h4>

             <p>For the crash triage section I reset the windbg connection in between each smash of the stack. The first round I smash the stack and check out the values of the registers to find what ones get hacker values (41414141 in eip, and ebp).</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_3.png" class="img img-rounded img-fluid"/>
             </div>

             <p>To investigate the data the registers point to I use 'dd' to inspect the data further. I find that the data is all hacker controlled 41414141 sequence! 
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_4.png" class="img img-rounded img-fluid"/>
             </div>

             <p> Now I pinpoint the location of the vulnerable function call in the program. This will be the wmemcpy function at 544320e0. The two snips below (step 1 and step 2) shows the windbg investigation to pinpoint the position found by stepping through function calls. 
             </p>
             <p>Step 1: crash program in inspect eip to see call that caused crash.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_5_a.png" class="img img-rounded img-fluid"/>
             </div>
             <p>Step 2: Use info to start stepping through to find position of vulnerability.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_5_b.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I reset the breakpoint to the breakpoint discovered above and inspect eip using "uf" to find that the size of the overflown buffer is 1024 bytes (400 in hex).</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_6.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Stack Exploit Lab</h4>

             <p>The purpose of this lab is to position a payload and have the program execute via the exploit found above. The first step is to just find the offset of the position of eip. This is accomplished using the msfPatternString and the byakugan package. See the snip below for the code details. With the knowledge of the offset we know where to position our injection.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_l1.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I change the source to add 42424242 instead of 41414141 to test that we have control of content. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_l2.png" class="img img-rounded img-fluid"/>
             </div>

             <p>In order to take advantage of the exploit we need to find a jump in execution, we can search the source for ff e4 wich is that command. We find one at 54432437.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_l3.png" class="img img-rounded img-fluid"/>
             </div>             

             <p>Now after considering the 4 byte padding we can position the source code. Note that the result should be the caluclator shell script for launching the calculator is run. I did not see the shell script execute. I tried many combinations of where the padding happend and the order of the script. This was frustrating but the source code below shows how the attack should be positioned to work.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L2_l4.png" class="img img-rounded img-fluid"/>
             </div>   

             <h4>Heap Attack</h4>

             <p>The heap is another vector for gaining code execution from a vulnerable process. In the next bit of exploration we examine how the heap can be investigated and probed for vulnerabilities. </p>

             <p>I refresh the html and attach windbg. I set a breakpoint at 54431ef0 and trigger the breakpoint. I use the !heap command with the –p and –a flags to inspect ecx. Note from the output that the size of the heap block is 8 bytes which points to a stackTimeClass. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L4_1.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Finally we examine the address of the first function in the ecx class identified above as 54431f30.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_4/L3_3.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Conclusion</h4>
             <p>This week we examine the way programs are executed on hardware. We find ways to work with tools to understand how programs are executed on hardware and ways to shift control to arbitrary instructions. We focus on old exploits in internet explorer that provide a very nice model for understanding how these attacks are possible on exposed systems such as an internet browser. </p>

            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_5">
        <div class="my-auto">
          <h2 class="mb-5">Week 5</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">


             <h4>Windows Internals: Rootkit Analysis</h4>

             <p>This week we dive in to the underlying windows kernel. We use the investigation of rootkits to learn about the kernel model in windows. We explore how the applications we run are in user mode as well as some drivers and the windows API. We see where the kernel mode drivers, file system drivers and operating system kernel are positioned between the hardware and the user. We ultimately discover that the agony rootkit hooks in to windows API’s, makes subtle changes that hide it from the user and keep it hidden. We examine the .sys file it generates in the “other kernel-mode drivers” under kernel mode. The main exploration of the internals follows the investigation of the agony rootkit. </p>

             <h4>Agony Rootkit</h4>

             <p>I start by extracting the agony sample and renaming it to “bad” on the desktop. This is of course because our cuckoo configuration expects the target application to be in this location. I start fakenet and run analyzer.py.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_1.png" class="img img-rounded img-fluid"/>
             </div>

             <p>After running I see a new file on the desktop called e2r355.ren. I replace the .ren extension with .html and discover it is the standard cuckoo response. This tells me that the malware is involved in network activity. Next I see that cuckoo has trapped three files</p>

             <div>
               <ol>
                 <li><b>sortdefault.nls.bin</b>: strings all shows some random strings, does not appear to be executable</li>
                 <li><b>tzres.dll.bin</b>: executable, strings all yields very few intelligible strings</li>
                 <li><b>bad</b>: appears to be a copy of agony executable. </li>
               </ol>
             </div>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_2.png" class="img img-rounded img-fluid"/>
             </div>

             <p>There also appears to be a file that is added to the analyzer directory called wininit.sys. I copy the file to the desktop (using Antispy) and open the copy with fileInsight. A strings all search yields quite a few plain text instances of “agony”. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_3.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I open Tuluka and examine the SST tab to find that the malware is referencing NtEnumerateValueKey, NtQueryDirectoryFile, and NtQuerySystemInformation. I use liveKD to inspect the code that was originally pointed to for NtEnumerateValueKey (82e80a0f) and the code that replaced it (9bcea480). Note that it references wininit at offset 0x1480! Essentially the malware has “hooked” these kernel API’s and filters calls to malicious code. Note we could use Tuluka to “restore” or “patch” back to the original memory location. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_4.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Back in liveKD we use the command “dps nt!kiServiceTable L1091” to inspect the system service descriptor table (SSDT). Here we see all the system API’s available. This illustrates how hooking works, find the SSDT and swap out the pointer to memory where the target code (code being hooked) with your function pointer. Note you need to save original pointer and point back to it when you want. See at the top and bottom where the wininit API’s have been swapped in. Also note their address space, all “normal” kernel space addresses start with “8” wininits are prefixed with 9. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_5.png" class="img img-rounded img-fluid"/>
             </div>


             <p>Now I will start a live debug session. I know that I would like to reference the memory locations that were identified in Tuluka where the API hooks are being referenced in memory. I take a screen shot for reference. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_6.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I move over from debuggee (machine I have been working on by executing agony with cuckoo) to debugger. I start a debug session and look up the address for NtEnumerateValueKey. I see that it is the value identified in my snip. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_7.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now I set a break point at the ntEnumerateValueKey and examine the call stack that point. Note that we do not see where wininit code is intercepting the flow control. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_8.png" class="img img-rounded img-fluid"/>
             </div>

             <p>In order to investigate we set a breakpoint at the “replacement” pointer 9bcea480 obtained in the Tuluka snip. Here we see the addition of the wininit+0x1480. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_9.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now I use the disassembly to step through the code to find the offset of where we return back to the hooked functions. Note that in windbg F8 can step through and F10 can step over. The general strategy is to step through every non-call instruction and examine call instructions for when execution is given back to the API of interest. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_10.png" class="img img-rounded img-fluid"/>
             </div>

             <p>I start with the NtEnumerateValueKey API. The original offset in wininit is 9bcea480, I find the call back to the original API (82e80a0f) at 9bcea4d4. The offset is thus 0x54 or 84 bytes.  </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_11.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Moving on to NtQueryDirectoryFile at 9bcea050 I discover that I have to clear all other breakpoints using “bc *” in order to get to this breakpoint. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_12.png" class="img img-rounded img-fluid"/>
             </div>

             <p>After stepping though some disassembly code we find that the call back to NtQueryDirectoryFile occurs at offset 0x36 or 54 bytes. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_13.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now for the final investigation we set the breakpoint for NtQuerySystemInformation. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_14.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Stepping through we find the offset that calls back to the native API at 0x1a or 26 bytes. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_5/agony_15.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Conclusion</h4>
             <p>Examining the agony rootkit was a great way to learn about windows system internals. The hands on experience with examining the low level API calls where rootkits may hook in to was a good way to learn about the windows kernel. It was surprising to me how “little” code the agony rootkit needed to execute to be efficient before returning control to the target APIs. It was also informative to see how a rootkit could potentially be cleaned or patched by restoring the memory pointers in the SSDT. </p>

            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_6">
        <div class="my-auto">
          <h2 class="mb-5">Week 6</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 


             <h4>Network Security</h4>
             <p>A computer by itself is capable of performing complex and valuable computation. A network of computer compounds the power of single computers to comprise unimaginably powerful systems. Networks have clear advantages for boosting the effectiveness of compute power and connecting information streams. The value that society has placed on connectivity has created has opened up a vast attack surface for malicious actors who want to steal data or manipulate networks. </p>

             <h4>Protocol</h4>
             <p>The fundamental concept for a computer network is communication. Computers are excellent at executing instructions exactly as they are defined. It is critical that defined protocols are devised that will describe exactly how the communication should take place. These protocols must take in to account connectivity and device specific limitations and decide how to deal with them. Once a protocol is proposed then every machine who wants to use it must come up with an implementation that acts according to the specification so that other machines can communicate.  </p>       

             <h4>Exploit</h4>
             <p>The fact that protocols must be specifically defined for all parties wanting to communicate means that attackers have access to the exact specification of the protocol for public communication. Thus they can devise strategies for manipulating the behavior of the defined protocol. In many ways there can be an advantage to someone who is interested in attacking a system where both parties (attacker and defender) have to abide by the same well defined rules. New protocols can be difficult to roll out because of legacy systems. If a new exploit is discovered the attacker can likely move faster than the defender can patch the system. </p>   

             <h4>Defense</h4>
             <p>An important task of the network architect and administrator is to identify and define the types of activities that are expected to be performed on the network. By defining the activity and types of interaction you expect you can build a “white list” of acceptable interaction. This allows you to enforce rules that only allow certain behavior and block and report all other behavior. This is a powerful concept because it allows the administrator to be explicit in what to allow and therefore block all other things that they do not expect. That being said it can be difficult in practice to define ever behavior that is expected to be allowed on a network. Things change rapidly and keeping up with insertions and deletions from the white list can be a full time job! The opposite of the white list is the black list. The black list is a definition of behavior that is known to be malicious. This can also be a powerful defense mechanism but it is important to note that a black list will grow and grow and there will always be a new behavior to add. It is a very difficult list to build and maintain. </p>   

             <h4>Example</h4>
             <p>In the example below we diagram a network and define rules and give example for what we would add to our white list. Note that some things will be allowable but will require that some conditions are satisfied. For example if an outside user wants to access the network resources they must VPN into the network using multi factor authentication before they are allowed to consume the data. </p>   

             <div class="col-sm-12 mb-3">
               <img src="./img/week_6/activity_table.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Robustness Principle: RFC-1122 Jonathan Postel, 1989</h4>
             <p> Below I have marked up Jonathan Postel’s 1989 robustness principle from RFC-1122. Red indicates a statement which I believe has changed with time while green indicates statements that I believe have stood the test of time. The first red highlight seems to not be aligned with the concept of a white list for network security. In the case of a firewall you would be conservative in what you “accept” if you consider that accepting something is “letting it through” to the network. </p>   

             <p>The next highlighted text is relevant today because as always it is a given that software will break. No matter how “perfect” a design is the system will eventually break down. A great design will account for failure modes and fail gracefully and safely. This actually leads in to the next highlighted text where adaptability in anticipation of change must be part of the design. The most fundamental part of this is to do it safely. IE failure modes should default to error out gracefully and not default to “allow” when an unexpected mode is encountered. </p> 

             <p>The red text in the second to last paragraph is important to consider in context of the white list principle. It is important that the system gracefully prevent failure modes without being overly restrictive of innovative features. The last green highlighted text illustrates this principle well in that the overall system should default to usable for known safe cases but be wary and block unknown cases. </p> 

             <div class="col-sm-12 mb-3">
               <img src="./img/week_6/robustness.png" class="img img-rounded img-fluid"/>
             </div>

             <h4>Network Profiling</h4>
             <p>The lab this week focused on analysis of packet headers captured on a network. The work was submitted in detail for lab 2. The code for analysis is hosted publicly and can be found below. </p>   

             <script src="https://gist.github.com/donoghuc/9ce93919c3b5205e4b64285665414d7e.js"></script>

             <h4>Conclusion</h4>
             <p>Netoworks security is a highly complicated and ever evolving field. It is important to secure networks and make them as usable and efficient as possible. There are many techniques for securing and monitoring a network. For example the use of white lists black lists and honeynets can help admins secure and understand the networks they are responsible for protecting. </p>   

            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_7">
        <div class="my-auto">
          <h2 class="mb-5">Week 7</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 

             <h4>Web Security</h4>
             <p>My first memory of the world wide web and the internet is in the library of my elementary school. I do not remember the browser or the search engine but I do remember the concept of “search for some key words and get some websites” (I was in 5th grade in 1998 so likely around then). This was unbelievable to me because the only other exposure I had to this kind of search indexing was a set of CD’s that contained the encyclopedia Britannica (or something similar). I bring this up because I can (barely) remember a time before the widespread use of the internet. </p>

             <p>It is interesting to think about how my parents experienced their first “search” far later in life and that my nieces and nephews will experience it early in life. The period of widespread adoption of the web provides THE LARGEST attack vector imaginable for hackers.  People who are new to the web or computers in general can be fooled into just about anything. The fact that the state of the conduct expected on the web is ever changing and not well defined make it easy for people to find creative ways to exploit one another. </p>

             <p>This week we focus on the MANY ways that the web can be used to exploit systems and gain information valuable to hackers. A stat that is presented in the lectures this week indicates that 95% of malware is delivered via the web. Malware and data theft are as prevalent and high profile as ever. In many ways the user is presents an “easy” target for attackers looking for an exploit. People can be tricked and conned MUCH easier than a computer program. Attackers can prey on human emotion or desire far easier than finding a new zero day in a complicated software system hardened against attacks. </p>

             <p>At the end of the day the weak link in web security is and has been the (human) user. The way that malware that is delivered and the exploits that target users are an excellent indication of how attackers choose the “easy” route of tricking users into divulging information or downloading malware. Below I show my favorite example. This “nice” looking website gives the user the sense of security in a polished UI and preys upon their desire for companionship. It is obvious that the attacker wants to simply steal passwords but I have no doubt that some people entered their information looking for a mate. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_7/date.png" class="img img-rounded img-fluid"/>
             </div>

             <p>They “good guys” are on to trickery that has been successful in the past by hackers and new strategies to defend the innocent casual web user are being rolled out. Some important concepts are the Certificate Authorities and making the web HTTPS by default. HTTPS aims to encrypt all web communication by TLS security. The argument against “secure by default” used to be that certificates were expensive and that de/encryption is computationally expensive. With the current state of hardware ability and the emergence of free certificates security by default is becoming more the norm. So much so that some browsers will display a warning to users when they are using a website that is not secured by HTTPS. </p>

             <p>Of course simply having a secure connection to download malware or to give away credentials is no silver bullet against the WWW as an attack surface. Another important factor for security is the validation of URLs. The advent of “big data” solutions and machine learning make it more and more feasible to start classifying URLs as “good” or “bad” in real time. Sites that deliver malware need to move faster and faster to deal with the fact that “good guys” are doxing them. 
             </p>

             <p>The general idea for using “big data” for keeping track of malicious sites is to identify methods for flagging sites as malicious based on observations on the web. To explore this topic I developed a classifier based on some labeled JSON data. The label is supplied that gives tags the URL as malicious or not and gives some information about the nature of the URL. I looked for patterns in the training data to write heuristics for calling out malicious sites. For example, for every numeric parameter I looked at a box plot comparing the malicious vs “clean” sites. The plot below shows how there is a clue for a heuristic for calling out a malicious site. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_7/sns.png" class="img img-rounded img-fluid"/>
             </div>

             <p>The outliers for the malicious URLS “host_len” field show that a malicious site is likely to have a total length of greater than 65 characters. By accumulating these heuristics and building heuristics I built a classifier at <a href="https://github.com/donoghuc/url_reputation" target="_blank"> https://github.com/donoghuc/url_reputation</a> </p>
             <h4>Conclusion</h4>
             <p>This week I spent most of my time developing the heuristics for identifying a malicious site. I would like to continue the project by developing a machine learning algorithm in the scikit learn python package index. In order to do this effectively I will need a good source for current training data and develop some more “tuning” for the weights of the features in determining the legitimacy of a URL without actually having to visit the site! </p>

            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_8">
        <div class="my-auto">
          <h2 class="mb-5">Week 8</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 

             <h4>Messaging Security</h4>
             <p>Spam is a term that describes content that is broadcast to anybody who will pay attention to it either consciously or subconsciously. Spam can be anything from physical “junk mail” to email. Email is far less expensive to broadcast than paying for postage on physical mail. The cost of producing E-spam is outweighed by the benefit of spreading malware or tricking users in phishing attacks. </p>

             <p>The goal of filtering spam is to stop it from reaching the user without filtering out the non-spam (ham) messages. This goal is simple enough to define but highly complex to actually implement. Reliably differentiating spam from ham with the luxury of time and computer resources is hard enough, add to the problem of performing filtering in real time and you have an extremely difficult engineering problem. </p>

             <p>In order to have an efficient spam filter you need to define rules for reliably separating the legitimate from illegitimate messages. These rules must be able to examine messages quickly and accurately in order to be economically feasible. </p>

             <p>Building rules for spam detection can be accomplished by studying historical data that has been marked as spam or not. We need to be clever in what data and meta data we use to identify spam. When we understand the indicators of spam we can make rules that can help define what messages are illegitimate. We have a database with metadata for 100K messages that have been marked as spam or not spam. </p>

             <h4>Analysis</h4>
             <p>I start by identifying the tables in the database using \dt in the psql shell. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/one.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Next I use the \d command to see the column names (and data types). </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/two.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Finally, in order to write queries in a nice text editor instead of the interactive shell I figure out what the database is called by using the current_database() method within the interactive shell. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/three.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now that I have the meta data about the database itself I can start writing queries in the text editor (with nice syntax highlighting and “saving”). I use the general I use the following call and options to run a query from the email_analysis.sql file and save it to /tmp/outpu.csv. This allows me to use the csv viewer (Gnumeric) for looking at nice tabular data. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/four.png" class="img img-rounded img-fluid"/>
             </div>

             <p>In the first query I just look at the first three rows of the data with the header to get a sense for what the data looks like.  </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/five.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Next I get counts for spam vs ham and find that there are 85K spam entries and 15K ham entries. Note the use of WITH syntax and commenting out queries. This is my style of doing exploratory analysis on relational databases because it allows you to build up queries without having deep nesting and keeps the code clean. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/six.png" class="img img-rounded img-fluid"/>
             </div>

             <p>The fact that blasting out spam is cheap it would make sense from a spammer’s perspective to push as much content as possible. With this idea I take the approach of finding the most popular “content” by examining the msubject and attachment hashes. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/seven.png" class="img img-rounded img-fluid"/>
             </div>

             <p>We see that the “Our New Stock Pick” has 61K occurrences! Spam for sure…</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/eight.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Similarly we find that there is a highly popular attachment hash (over 63K occurances). </p>


             <p> Now that we have some popular spam we will link back to some IP addresses associated with the sender. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/nine.png" class="img img-rounded img-fluid"/>
             </div>

             <p>Now I see what we get from selecting everything with the IP address that has a hit in the “popular” data. I do a count method and find we get 79492 entries. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/ten.png" class="img img-rounded img-fluid"/>
             </div>

             <p>In order to get a sense of “accuracy” I do a join and find the “identified” spam vs the “known spam”. We see that there are about 6K “false positives” based on our method. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/eleven.png" class="img img-rounded img-fluid"/>
             </div>

             <p>The query for finding the “misses” is not optimized at all. It took well over 5 minutes to run. It should be refactored using join logic. This actually shows how analysis of messages can take quite a bit of time if not though of carefully. </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/week_8/twlev.png" class="img img-rounded img-fluid"/>
             </div>         

             <h4>Conclusion</h4>
             <p>We see that our heuristic method of finding the message meta data that is most prevalent and then filtering based on linking back IP sources is somewhat effective. We also discovered how even with only 100K entries the query time can be quite expensive for real time applications for certain queries. </p>
            </div>
             
          </div>

        </div>

      </section>



      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_9">
        <div class="my-auto">
          <h2 class="mb-5">Week 9</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_10">
        <div class="my-auto">
          <h2 class="mb-5">Week 10</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/resume.min.js"></script>

  </body>

</html>
