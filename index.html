<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="donoghuc DADA">
    <meta name="author" content="Cas Donoghue">
    <link rel="shortcut icon"
          href="img/Hallows.png">
    <title>donoghuc CS373</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/resume.min.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">
        <span class="d-block d-lg-none">D.A.D.A</span>
        <span class="d-none d-lg-block">
          <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/profile.jpg" alt="">
        </span>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_1">Week 1</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_2">Week 2</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_3">Week 3</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_4">Week 4</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_5">Week 5</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_6">Week 6</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_7">Week 7</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_8">Week 8</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_9">Week 9</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#week_10">Week 10</a>
          </li>

        </ul>
      </div>
    </nav>

    <!-- ABOUT -->

    <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5 d-flex d-column" id="about">
        <div class="my-auto">
          <h1 class="mb-0">Cas
            <span class="text-primary">Donoghue</span>
          </h1>

          <div class="subheading mb-5"> Defense Against The Dark Arts · CS373 · donoghuc 
          </div>
          <p class="mb-2">This site has my notes for each week of D.A.D.A. Use the navigation bar to select week of interest. </p>
          <p class="mb-2">I am using the engr web server to host this site. The source code can be found on <a href="https://github.com/donoghuc/public_html" target="_blank"> github</a>. Please see repo for image credits</p>
          <p class="mb-5"><b>NOTE:</b> For the non-potterheads out there Defense Against The Dark Arts is a class at Hogwarts in the Harry Potter novels. The profile picture in the nav bar is Gilderoy Lockahrt, although he is a charlatan he is a lovable and hillarius character. Also die-hard fans may recognize the favicon for the site as the symbol of the deathly hallows.</p>
        </div>
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_1">
        <div class="my-auto">
          <h2 class="mb-5">Week 1</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">

             <h4> What is Malware? </h4>
             <p> Malware is a concatenation of the words “malicious” and “software”. It is a term used to describe software used to perform nefarious and unwanted actions on a system.
             </p>

             <h4>Whyyyyy????? </h4>
             <p>Humans (and any living creature) are self-interested and often times the path of least resistance to survival is to take what you want by force. If something is exploitable (software or otherwise) it will inevitably be taken advantage of by someone. The attack surface for software systems offers a vast opportunity for exploit by hackers who want to profit from spying, stealing or destroying systems. Society’s fast adoption of and utter reliance on software systems are a massive vulnerability. Exploiting that vulnerability can be profitable by cyber criminals who can safely carry out their crimes in the comfort of their office chair. 
             </p>

             <h4>Malware types</h4>
             <p>
               <ul>
                 <li>
                   <b>Virus:</b> Typically an executable file that will start infection with some user interaction (ie running a program in an email attachment). 
                 </li>
                 <li>
                   <b>Worm:</b> Type of virus that can spread without user interaction (ie replication without user intervention). 
                 </li>
                 <li>
                   <b>Trojan:</b> A Trojan is malware hidden within a file type (PDF, word doc, excel, etc) which seems to be benign or useful to the user. Trojans are often associated with “backdoors” ie software that gives an attacker a way to silently monitor and control you computer. 
                 </li>
               </ul>
               <iframe width="420" height="315"
                  src="https://www.youtube.com/embed/y8a3QoTg4VQ">
               </iframe>
             </p>

             <h4>How does malware spread?</h4>
             <p>Attackers are innovative and engineer attack vectors in many clever ways. The general idea/theme is that a user is tricked in to installing the malicious code. This can be achieved through hiding malware in content the user might find interesting or useful. Instead of me presenting a list of different attack vectors I will share a personal example. I had a colleague when I worked in biotech who was hopelessly computer illiterate and extremely impatient. He wanted to convert an image file from .jpg to .tif and did a google search for a tool to do so. He downloaded and installed a “tool” and immediately regretted it! In this example the user was tricked into installing malicious code because he wanted a quick fix to a problem he did not want to research. It should also be noted that exploiting users just turns out to often be the “easiest” way to spread malware. There can also exist vulnerabilities in system code or hardware that allows attackers to install malware. These exploits often require more research and skill for the hacker to successfully utilize. 
             </p>

             <h4>Scary stuff</h4>
             <p>Malware can be used to spy on user activity and extract information (spyware). This is frightening enough but there are also Remote Access Trojans (RAT) that allow attackers to completely control an endpoint. The idea that a computer or server that you think you control is actually being controlled by a nefarious entity is a scary thought! 
             </p>

             <h4>Who can save us?</h4>
             <p>Luckily it is also profitable to be in the anti-malware business! Researchers and security firms are growing at an incredible rate and are trying to keep up against the threats. Security suffers from the classic problem that is it often more difficult to defend something than to attack it. In order for researchers in the industry to compare notes and describe malware they have come up with a naming convention. Unfortunately the naming convention is not always followed perfectly, instead the best way to archive and share information about malware is to calculate a hash value on malicious code. The hashes used are typically md5 and can be represented in a hexadecimal string that is unique and easily compared to other samples. Below I show some python code to take an md5 hash of a virus sample from lab1. 
             </p>
             <p><script src="https://gist.github.com/donoghuc/cfe4343f7c94d1c00f0c938a7b6eb166.js"></script></p>
             <h4>How do researchers study malware?</h4>
             <p>It is in the interest of an attacker to hide their actions and obfuscate their malicious code to dupe security analysts. This has resulted in an “arms race” between attackers and defenders that has escalated quickly. A researcher who looks only at code (which is often encrypted or intentionally vague or confusing) is perfroming <b>static analysis</b>. Static analysis can yield valuable insight into the malware and can actually give clues as to its origins. For example if everything is written in a certain language (think Russian, Chinese not java, c) or if it is using encryption techniques popular in particular “circles”. At the end of the day it can often be more beneficial to study malware by just observing it in action <b>(dynamic analysis)</b>. In order to do this dedicated systems are put in place (called sacrificial goats) to be studied. Of course attackers have gotten wise to this and created measures to try to detect goats and subvert research. Another closely related idea is to set up traps (honeypots) that attract malware to try to catch samples for study. Researchers have developed many tools to analyze exactly what malware is doing to infected systems. We explore some of these tools in lab this week. 
             </p>
             <h4>Lab 1</h4>
             <p>
             For our first lab we got access to a windows VM (heavily partitioned from network of course!). We preserve the “fresh” pre-infected state of the machine using snapshots, then infect the machine using a provided piece of malware. We used the following tools to perform analysis of the malware. 
             <ul>
               <li><b>FlyPaper:</b> Trap processes from closing and networking (can have some unintended consequences if you think about it!)</li> 
               <li><b>FakeNet:</b> Set up fake network protocol that captures the network requests of all processes running. Quite handy for determining how malware is trying to communicate back to attacker.</li>
               <li><b>ProcessExplorer:</b> Simple windows tool for logging every process that is being executed on a machine in excruciating detail. </li>
               <li><b>ProccessMonitor:</b> An interface to see high level execution steps of programs on a system.</li>
               <li><b>AntiSpy:</b> Deep dive into all files in a system (even hidden ones) with tons of amazing features for investigating files, registry keys etc.</li>
               <li><b>FileInsight:</b>Hex editor to look at binary code. Has tons of features for decryption and static file analysis. </li>
             </ul>
             We used these tools to examine a sample of malware designed to persist on a machine. We saw how it infects the machine, communicates back to attackers and then persists on the machine. After doing some research I found the following blog post that describes an example of the malware we investigated that was used to attack banks. The idea was to use the malware to silently redirect bank customer users to a fake site (that mimicked the real bank interface) to steal credentials. Furthermore the second stage of the attack allowed the attacker to have a backdoor into the system and update the system with new executable code persistently. <a href="https://blog.avast.com/2013/03/19/analysis-of-chinese-attack-against-korean-banks" target="_blank">Analysis of chinese attack against korean banks</a>  
             </p>
             <h4>Conclusion</h4>
             <p>This first week was highly inspiring. The lectures were by <a href="https://securingtomorrow.mcafee.com/author/christiaan-beek/" target="_blank">Christian Beek</a> who has a brilliant lecture style and is clearly an expert on security research. Christian’s lectures are engaging and informative in that he provides real world examples of malware and give insight into how researchers study infections. I cannot wait for next week’s lectures to be published! </p>
            </div>

          </div>
        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_2">
        <div class="my-auto">
          <h2 class="mb-5">Week 2</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> 

             <h4>Forensics Overview</h4>
             <p>This week we dive in to advanced forensics techniques. The discussion is framed as an investigator looking in to a computer or system to understand what that system has been used for. As an investigator your job is to prove what happened on machine, not to prove whether an individual is guilty or not guilty. We focus on an objective analysis and methods to effectively handle volatile data collected from a machine. 
             </p>

             <h4>Data Collection</h4>
             <p>The first step in an investigation is to gather evidence. Evidence could include information about the network, operating system, databases, applications, removable media and other peripheral devices. Digital evidence is by nature somewhat fragile and susceptible to tampering. Standards and best practices have been developed to preserve data integrity such as hashing data on arrival and throughout the process making sure hashes match with the original. During an investigation it is important to consider <b>Locard’s Exchange Principle</b>: <em>for any two objects come in to contact, there is always transfer of material from each object to the other</em>. You cannot interact with a live system without having some effect on it. It is crucial to document and understand the effect you are having on the system to preserve evidence integrity.  
             </p>

             <h4>Data Fragility</h4>
             <p>Data is fragile in nature as it can be ephemeral in its existence in physical memory. A perfect example of highly volatile data is RAM. RAM is constantly in flux and specific physical memory is being overwritten over the course of the hardware’s lifetime. We will consider some data in context of its volatility from most volatile to least. The most volatile data is the system memory, this can easily be lost or damaged beyond repair. Temporary file systems are also quite volatile. Process tables and network connection information is ephemeral and can be lost over time. Similarly network routing information can be lost. More persistent data are data stored on disks, remote logging data, network topology information and finally system backups. Data should be collected as to minimize loss of volatile data.  
             </p>

             <h4>FTK Imager</h4>
             <p>FTK imager is a simple yet powerful tool for capturing an image of a hard disk. This allows a snapshot of the drive that can be shared and examined by researchers. As you would expect there are tools in the application that allow the researcher to generate and compare hashes of the image to determine data integrity. FTK imager was used to create the mayflower image for the investigation challenge below. (Note I am not going to make image of VM because it is boring…).  
             </p>

             <h4>Volatility</h4>
             <p>FTK imager is wonderful for investigating persistent disk storage. A tool for investigating RAM is important to discover the wealth of forensic data in physical memory. Analyzing RAM can reveal “hidden” artifacts that prove useful in investigation such as decrypted versions of otherwise encrypted data, keystrokes, WEP and WPA keys, username/passwords, DLL info (including malicious ones). At the end of the day every running process will leave some trace in memory. Volatility is a tool used to analyze a memory dump.  
             </p>

             <h4>Test out volatility</h4>
             <p> I copied volatility exe and memdump sample into a volatility_lab directory to investigate. I start with the imageinfo functionality. From here we can see the time the image was taken and other information. Specifically we are interested in the profile suggestions.  </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/volatility_img_info.png" class="img img-rounded img-responsive"/>
             </div>

             <p> After finding the profile information I can run psscan. This allows me to find process ID's for programs of interest (most notably evil.exe PID:1216)</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/psscan.png" class="img img-rounded img-responsive"/>
             </div>

             <p> Now I investigate the link libraries that evil.exe (PID: 1216) calls using dlllist</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/dlllist.png" class="img img-rounded img-responsive"/>
             </div>

             <p> Examine the network activity from mem dump with netscan. This shows evil.exe net activity. </p>
             <div class="col-sm-12 mb-3">
               <img src="./img/netscan.png" class="img img-rounded img-responsive"/>
             </div>

             <p> I tried running the deskscan plugin but did not find anything i could identify as malware. The getsids plugin is used for getting security IDs shows both evil.exe and svchest.exe. These show how "deep" into the system the malware has spread by showing the user rights and privileges the malware is running with.</p>
             <div class="col-sm-12 mb-3">
               <img src="./img/sids.png" class="img img-rounded img-responsive"/>
             </div>
             
             <h4>Timeline</h4>
             <p>It is important for the analyst to build up a timeline of actions that occurred on the machine being studied. Windows uses a file system called a registry to track and coordinate all activities that go occur on a machine. Regmon can be used to display registry activity in real time and you can see registers as a directory structure using regedit.exe. The Registry is a forensics log, you can find all sorts of information such as auto run tasks, geolocation, peripheral drives, internet activity etc. The registry can be helpful in building your timeline. The other tools that can help build a timeline are volatility, searching through the Master-File-Table and using a tool called Reg-Ripper.  
             </p>

             <h4>Data Recovery</h4>
             <p>When the casual user of a system deletes a file they tend to think that it is truly “gone from existence”. This is rarely the case. There are processes for recovering data that take advantage of how data is stored and managed on physical devices. In fact, data recovery tools are so advanced now that many institutions that need to truly erase sensitive data will destroy physical memory devices for fear of data being recovered! 
             </p>

             <h4>Mayflower Challenge</h4>
             <p>A DPRK Defector was caught close to the border of North and South Korea. The person was member of DPRK’s Unit 21 – Cyber-Army Division. The person had an USB-stick hidden in his clothes. An image was made of the USB-stick. 
             </p>
             <p>I first made sure I had a fresh snapshot of my clean VM. I then copied the Image_USB_Mayflower.001 image from the network share to a directory on my VM called mayflower. I mounted the image and aliased it to the E drive using OSFMOUNT and copied the directory to the mayflower directory on my desktop. I was curious about the names as they were in glyphs I do not understand. In order to investigate this I wanted to copy paste the files into google translate. The only problem is the VM does not allow any data transfer. To get around this I wrote some python code (both on the VM and my local machine) to do Optical Character Recognition so I could effectively copy paste the information. I have published that code as well as detailed setup in a <a href="https://github.com/donoghuc/python_ocr" target="_blank" > public git reposotory </a>.    
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/translation.png" class="img img-rounded img-responsive"/>
             </div>

             <p>Next I wanted to see if there are any deleted files on the image. I order to do this I use photorec and dump the recovered files in the mayflower directory. I poke around and find quite a bit of information that was recovered. 
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/photo_req.png" class="img img-rounded img-responsive"/>
             </div>

             <p>Now based on a hint from the lecture I do a strings search on the “don’t tell mrs Il Ung.jpg” file and find the following match at offset 0x00003B0: ‘pwd:infected123!’. This is the password to the .zip file (target list.zip). I am able to extract the target list using the password.
             </p>

             <div class="col-sm-12 mb-3">
               <img src="./img/pwd_infect123.png" class="img img-rounded img-responsive"/>
             </div>

             <p>Here are the targets I found</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/targets.png" class="img img-rounded img-responsive"/>
             </div>

             <p>Based on another lecture hint and an helpful post on the discussion boards by Joe Beauchesne I use file insight to search for “SPE” using the XOR text search plugin. The hint is in the file paths in the warning message image. This leads me to discover the usernames, passwords and some IP addresses hidden in the rootkit.bin file (see notepad for this info). </p>
 
             <div class="col-sm-12 mb-3">
               <img src="./img/spe_hint.png" class="img img-rounded img-responsive"/>
             </div>

             <p>Now that I have investigated some things it is time to infect my machine! I fire up process monitor/explorer and fakenet. I rename the rootkit.bin file to rootkit.exe and run it. I do not see any activity on fakenet and I do not see any scheduled tasks with cmd.exe at command. I do however see an endless list of processes in process monotor. I stop collection and begin digging. The list of dlls and other modifications the software makes is staggering. Based on the name of the file it is a rootkit which could be making subtle changes and hiding easter eggs all over my system. I also try using flypaper and it eventually crashes my VM. I can only speculate at this point what the rootkit may be doing to the system. If I had not known based on the file name translation it would be difficult to even see the program is doing anything.</p>

             <div class="col-sm-12 mb-3">
               <img src="./img/run_rootkit.png" class="img img-rounded img-responsive"/>
             </div>          

             <h4>Conclusion</h4>
             <p>What an amazing, fun week! The tools we used such as volatility and imagerec are beyond cool. I cant wait to start doing image recovery on some old flash media I have laying around the house. I think that the mayflower project was really fun. I want to learn more about what the rootkit is doing. I find that my knowledge of windows OS is somewhat slowing me down. That is not to say I am any kind of linux master but I do feel way more at home with a bash shell. Looking forward to the weeks to come!  
             </p>
            </div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_3">
        <div class="my-auto">
          <h2 class="mb-5">Week 3</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_4">
        <div class="my-auto">
          <h2 class="mb-5">Week 4</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_5">
        <div class="my-auto">
          <h2 class="mb-5">Week 5</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_6">
        <div class="my-auto">
          <h2 class="mb-5">Week 6</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_7">
        <div class="my-auto">
          <h2 class="mb-5">Week 7</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_8">
        <div class="my-auto">
          <h2 class="mb-5">Week 8</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>



      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_9">
        <div class="my-auto">
          <h2 class="mb-5">Week 9</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

      <!-- SECTION BREAK -->

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="week_10">
        <div class="my-auto">
          <h2 class="mb-5">Week 10</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto"> Comming Soon!</div>
             
          </div>

        </div>

      </section>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/resume.min.js"></script>

  </body>

</html>
